# MicroDynamics开发者日志

---
## 2016.7.5

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、完成MicroDynamics团队整体项目的规划工作。<br>
2、确定了GitHub团队组织仓库的基本管理方案。<br>

**计划：**<br>
1、尽快在接下来的几天内完成团队的开发风格指南。<br>
2、学习Qt界面编程，编写出简单的项目界面。<br>

---
## 2016.7.6

**作者：**<br>
maksyuki<br>

**完成：**<br>
1、经过讨论后完成了团队标志的初步设计工作。<br>
2、制定了暑假Breeze无人机嵌入式部分算法设计的开发计划。<br>

**计划：**<br>
1、通过相关书籍和网络来学习STM32开发的基本知识和流程。<br>
2、进一步学习并掌握以PID为基础的控制算法，熟悉无人机飞行相关知识。<br>

---
## 2016.7.6-7.12

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、搞定了团队开发风格指南。<br>
2、完成了Breeze无人机飞行控制站的基础界面设计。<br>

**计划：**<br>
1、配置并优化界面。<br>
2、学习无人机通信协议，尽快把协议整合到Breeze无人机飞行控制站中。<br>

---
## 2016.7.22

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、已将串口协议整合到Breeze无人机飞行控制站中。<br>
2、简化图形界面。<br>

**计划：**<br>
1、配置STM32开发环境。<br>
2、将通信协议添加到STM32代码中。<br>

---
## 2016.7.24

**作者：**<br>
maksyuki<br>

**计划：**<br>
1、深入了解开源飞控算法中关于高度融合部分的代码，进而实现Breeze沿Z轴方向的定高悬停。<br>
2、从整体上把握开源飞控算法在任务调度、执行方面的实现。<br>

---
## 2016.8.12

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、配置完成STM32开发环境。<br>
2、完善STM32开发模板。<br>

**计划：**<br>
1、搜集与PCB设计相关的书籍或资料，开始学习PCB的设计。<br>
2、参考Crazypony的PCB，保持功能不变，只修改外观设计。<br>

---
## 2016.8.13

**作者：**<br>
maksyuki<br>

**完成：**<br>
1、完成飞控算法中相关寄存器的配置和驱动的编写。<br>
2、对于STM32中SPI、IIC总线和PWM驱动进行了相关的测试。<br>

**计划：**<br>
1、实现DMA驱动的编写并实现无人机LED灯语的设计和编程。<br>

---
## 2016.8.23

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、完成Breeze无人机元器件和封装库的设计与配置。<br>
2、画完Breeze无人机原理图。<br>

**困难：**<br>
1、在画原理图的时候，我发现整个系统中存在着很多不同功能的电源。这些电源分布在机体的各处，与很多IC都存在关系。我想这个需要花一些时间来弄明白，因为这对之后PCB中的电源设计是至关重要的。<br>

**计划：**<br>
1、搞定原理图中的电源关系。<br>
2、开始着手设计PCB的布局，并尽快完成最后总体的布线工作。<br>

---
## 2016.8.28

**作者：**<br>
maksyuki<br>

**完成：**<br>
1、完成Breeze无人机飞控算法中所有底层驱动模块的编写并用库函数重写了SPI驱动。<br>
2、实现了NRF24L01无线系统模块的编写，无人机和遥控器可以进行匹配并传送数据<br>

**困难：**<br>
1、在我编写完系统主时钟驱动模块后，想测试一下在系统中断存在的情况下PWM输出驱动电机的情况。结果发现电机在输入值都是10的情况下出现嘶嘶声。开始还觉得是电池电压不够造成的，后来经过多次的烧写和在线调试，发现PWM输出值的范围是100~999。<br>

**计划：**<br>
1、实现系统传感器(IMU、气压计)的初始化操作。<br>
2、优化先前编写的代码。<br>

---
## 2016.9.12

**作者：**<br>
myyerrol<br>

**完成：**<br>
1、搞定部分模块的布局问题。<br>
2、修改元件安全间隔为0.15毫米。<br>

**困难：**<br>
1、在对Breeze无人机进行完第二次PCB布局后，我发现无论我怎样放置模块，都很难将元器件彼此分开。这会导致在布线的时候，PCB上没有足够的空间来走线。<br>

**解决：**<br>
1、适当地在PCB的背面布一部分的元器件模块。<br>

**计划：**<br>
1、完成Breeze无人机剩下模块的布局。<br>
2、尽快进行双面的PCB布线。<br>

---
## 2016.9.19

**作者：**<br>
myyerrol

**完成：**<br>
1、搞定Breeze四轴电机、传感器和电源等模块的PCB布线。<br>
2、修复原理图中的一些错误。<br>

**困难：**<br>
1、在进行PCB布线的时候，我发现KiCad自带的自动布线功能实在是非常有限，而自己使用手工布线问题又非常多。比如信号线的拐弯处成锐角或直角、板子的过孔过多等。<br>

**解决：**<br>
1、经过一段时间的网上搜索，我终于找到了解决方案。问题的解法就是使用KiCad带有的交互式布线功能（这个功能需要先开启对OpenGL的支持）。这种布线模式最大的好处就是可以在布线的时候通过挤压其他导线来自动地处理它们之间的位置关系，从而极大地减少了因导线交叉而使用过孔的问题。而且整条导线根据拐弯处被划分成若干条线段，这样有利于对布线的角度进行精确的修改。<br>

**计划：**<br>
1、尽快完成对PCB剩余模块的布线。<br>
2、拆分原先的原理图，并按照模块进行划分。<br>

---
## 2016.10.8

**作者：**<br>
maksyuki

**完成：**<br>
1、完成Breeze飞行控制部分代码的编写。<br>

**计划：**<br>
1、尽快实现通信中有关油门数据的发送和转换部分的代码。<br>
2、进行Breeze整机飞控代码的测试。<br>

---
## 2016.10.19

**作者：**<br>
maksyuki

**完成：**<br>
1、完成油门数据的接收和转换计算部分代码的编写。<br>
2、完成整机飞控代码中关于硬件驱动初始化部分相关函数的整理、重写和测试。<br>

**困难：**<br>
1、在进行相关硬件驱动初始化测试的过程中，发现程序运行到MS5611_WaitBaroInitOffset()函数处出现死循环的情况。结合串口输出和软件debug最终发现是其中调用的计时函数micros()由于没有开启系统定时器SysTick中断来累加计数得到确定的时间，导致micros()一直返回0。另外同时出现delay_us()和delay_ms()函数同时使用SysTick计数和micros()函数冲突进而导致延时不稳定的情况。<br>

**解决：**<br>
1、这里采用外接晶振并通过PLL倍频到72Mz来取代原先的内部时钟信号，作为整个系统的时钟源。按照STM32所提供的技术参考手册上的配置方式配置并开启SysTick定时中断。delay_us()和delay_ms()函数不再采用SysTick定时器作为定时标准，这里直接采用定时中断累加实现。<br>

**计划：**<br>
1、开始着手测试利用主定时器实现中断嵌套功能部分的代码。<br>
2、进行IMU数据的标定和姿态融合算法的测试。<br>

---
## 2016.10.26

**作者：**<br>
maksyuki

**完成：**<br>
1、完成利用主定时器实现中断嵌套功能部分代码的编写。<br>
2、完成整机飞控代码中涉及到姿态和油门控制的部分，经过简单测试Breeze可以保持一个基本的姿态稳定和定高悬停。<br>

**说明：**<br>
1、Breeze基本上实现了稳定控制，代码按照驱动级、外设级和算法级进行了分类，便于修改和维护。在实际测试过程中发现机体遇到障碍物时会出现电机座断裂和断桨的情况，这说明在机械强度设计上还需要考虑更多。比如采用和Tiny Whoop类似的涵道支架设计，这样可以在保持外形美观的情况下有效减少断桨的情况。另外可以参考crazyfile橡胶电池座的设计来减少底座断裂的情况。<br>

**计划：**<br>
1、优化飞控代码的结构并添加必要的注释和说明。<br>
2、实现一键起飞、定高，一键降落的功能。对于姿态解算部分采用卡尔曼滤波算法来代替原来的Mahony互补滤波算法，以达到更高的解算精度。<br>
3、在STM32上构建FreeRTOS，并在FreeRTOS上完整移植飞控算法。<br>

---
## 2017.01.15

**作者：**<br>
myyerrol

**完成：**<br>
1、配置了Cadence 16.6 EDA开发工具。<br>
2、搭建了Git版本控制系统。<br>

**计划：**<br>
1、学习Cadence的基本使用，掌握原理图和PCB的制作方法。<br>
2、阅读《ARM Contrex-A8 硬件设计DIY》，制定详细的设计方案。<br>

---
## 2017.01.21

**作者：**<br>
myyerrol

**完成：**<br>
1、学习了天嵌E8开发板的相关开发资料。<br>
2、收集了一些其他微型四轴飞行器的资料。<br>

**计划：**<br>
1、尽快将固件烧写到天嵌E8开发板中，学会基本的ARM配置过程。<br>
2、根据E8实际运行的效果和之前Phenox2的相关资料，最终确定整个硬件设计方案。<br>
